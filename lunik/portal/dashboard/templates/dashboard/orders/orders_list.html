{% extends 'base_shop.html' %}

{% load humanize %}
{% load thumbnail %}
{% block title %}{{store_instance.name}}{% endblock title %}
{% block subtitle %} Mis pedidos {% endblock subtitle %}

{% block menu %}
{% include 'shop/includes/partial_menu.html' %}
{% endblock menu %}
{% block cart %}
{% include 'shop/includes/partial_cart_detail.html' %}
{% endblock cart %}

{% block content %}
	<!-- content page -->
	<section class="bgwhite p-t-66 p-b-60">
		<div class="container">
			<div class="row">
				<div class="col-md-12 p-b-30">
                        <div class="">
                            <h2 class="m-text26 p-b-0">
                                LISTA DE PEDIDOS
                            </h2>
						{% if orders %}
						<div class="row">
								{% for order in orders %}
								<div class="col-md-3 mr-4 p-3 mt-3"
									style="border: 1.5px solid #eaeaea;box-shadow: 0px 0px 6px 0px #eaeaea; width:max-content; margin-inline-end: 15px;">
									<div class="item d-flex justify-content-between w-100">
										{% for item in order.products_orders.all %}
										{% with image=item.product.products_gallery.all.first.image %}
										{% thumbnail image '240x240' crop='center' as img %}
										{% if forloop.first %}
										<img src="{{img.url}}" class="img-fluid" style="width: 10rem; margin-right: 10px;">
										{% endif %}
										{% endthumbnail %}
										{% endwith %}
										{% endfor %}
										<div class="item">
											<p class="font-weight-bold">PEDIDO NO. {{order.folio}}</p>
											<p class="font-weight-bold">Comprado el {{order.created|date:"d/m/y"}}</p>
											<p class="font-weight-bold">Total : ${{order.order_payment.total|intcomma}}</p>
											<p class="font-weight-bold">
												{% for product in order.products_orders.all %}
												{{product.product}}{% if not forloop.last %},{% endif %}
												{% endfor %}
											</p>
										</div>
									</div>
									<div class="d-flex justify-content-between">
										<div class="size10" style="margin: 20px 0;">
											<!-- Button -->
											<a href="{% url 'dashboard:order_detail' order.pk %}" class="flex-c-m size2 bg1 bo-rad-23 hov1 m-text13 trans-0-4 w-50 mr-2"
                                                style="height: 30px;font-size: 12px;">Ver Detalles</a>
											</a>
										</div>
										<div class="size12" style="margin: 20px 0;">
											<!-- Button -->
											<span>
												{% if not order.active %}
												Cancelado <i class="bi bi-x-circle"></i>
												{% else %}
													{% if order.order_payment.status == 'PE'%}Pendiente <i class="bi bi-clock"></i>
													{% elif order.order_payment.status == 'EP'%}En proceso <i class="bi-pin"></i>
													{% elif order.order_payment.status == 'EE' %}Enviado <i class="bi bi-truck"></i>
													{% elif order.order_payment.status == 'EN' %}<span style="color:green">Entregado <i class="bi bi-check-circle"></i></span>
													{% endif %}
												{% endif %}

											</span>
										</div>
									</div>
									
								</div>
								{% endfor %}
						</div>
						
					{% else %}
						<h4 class="mt-5 text-center">USTED NO TIENE NINGUN PEDIDO REALIZADO</h4><br>
					{% endif %}
					</div>
				</div>
			</div>
			{% if orders.has_other_pages %}
			<div class="pagination flex-m flex-w p-t-26">
				{% if orders.has_previous %}
				<a href="?page={{orders.previous_page_number}}"
					class="item-pagination flex-c-m trans-0-4" ><i class="fa fa-chevron-left"></i></a>
				{% endif %}
				{% for i in orders.paginator.page_range %}
				<a href="?page={{i}}"
					class="item-pagination flex-c-m trans-0-4 {% ifequal i orders.number %}active-pagination{% endifequal %}" >{{i}}</a>
				{% endfor %}
				{% if orders.has_next %}
				<a href="?page={{orders.next_page_number}}" class="item-pagination flex-c-m trans-0-4"><i
						class="fa fa-chevron-right" ></i></a>
				{% endif %}
			</div>
			{% endif %}
		</div>
	</section>
{% endblock content %}

{% block customjs %}
<script src="{{STATIC_URL}}js/shop.js"></script>
{% endblock customjs %}